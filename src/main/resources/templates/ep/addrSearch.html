<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<!--<script type="text/JavaScript" src="/js/jquery-1.8.3.min.js" ></script>-->
	<script src="https://code.jquery.com/jquery-3.6.4.js"
			integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E=" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

	<title>Insert title here</title>
</head>
<body>

<form name="form" action="#" id="form" method="post">
	<input type="hidden" name="currentPage" value="1"/> <!-- 요청 변수 설정 (현재 페이지. currentPage : n > 0) -->
	<input type="hidden" name="countPerPage" value="10"/><!-- 요청 변수 설정 (페이지당 출력 개수. countPerPage 범위 : 0 < n <= 100) -->
	<input type="hidden" name="resultType" value="json"/> <!-- 요청 변수 설정 (검색결과형식 설정, json) -->
	<input type="hidden" name="confmKey" value="devU01TX0FVVEgyMDIzMDUwMjEyMjkwMDExMzczNjE="/><!-- 요청 변수 설정 (승인키) -->
	<input class="form-control me-2" type="text"     name="keyword" value="" onkeydown="enterSearch();"/><!-- 요청 변수 설정 (키워드) -->
	<input class="btn btn-outline-primary" type="button"  onClick="getAddr();" value="주소검색하기"/>
	<div id="list" ></div><!-- 검색 결과 리스트 출력 영역 -->
</form>


<script language="javascript">
	function getAddr(){
		// 적용예 (api 호출 전에 검색어 체크)
		if (!checkSearchedWord(document.form.keyword)) {
			return ;
		}

		$.ajax({
			url :"https://business.juso.go.kr/addrlink/addrLinkApiJsonp.do"  //인터넷망
			,type:"post"
			,data:$("#form").serialize()
			,dataType:"jsonp"
			,crossDomain:true
			,success:function(jsonStr){
				$("#list").html("");
				var errCode = jsonStr.results.common.errorCode;
				var errDesc = jsonStr.results.common.errorMessage;
				if(errCode != "0"){
					alert(errCode+"="+errDesc);
				}else{
					if(jsonStr != null){
						makeListJson(jsonStr);
					}
				}
			}
			,error: function(xhr,status, error){
				alert("에러발생");
			}
		});
	}

	function makeListJson(jsonStr) {
		var htmlStr = "";
		htmlStr += "<table>";
		htmlStr += "<tr>";
		htmlStr += "<td>" + "도로명주소" + "</td>";
		htmlStr += "<td>" + "우편번호" + "</td>";
		htmlStr += "</tr>";
		$(jsonStr.results.juso).each(function () {
			htmlStr += "<tr>";
			htmlStr += "<td >" + "<a onclick='addrPass()' id='roadAddr'  value='" + this.roadAddr + "'>" + this.roadAddr + "</a>" + "</td>";
			htmlStr += "<td>" + "<input id='zipNo' type='hidden' value='" + this.zipNo + "'>" + this.zipNo + "</td>";
			htmlStr += "</tr>";
			htmlStr += "<tr>";
			htmlStr += "<td>" + "<input id='roadAddrPart1' type='hidden' value='" + this.roadAddrPart1 + "'>" + this.roadAddrPart1 + "</td>";
			htmlStr += "</tr>";
		});
		htmlStr += "</table>";
		$("#list").html(htmlStr);
	}


	//특수문자, 특정문자열(sql예약어의 앞뒤공백포함) 제거
	function checkSearchedWord(obj){
		if(obj.value.length >0){
			//특수문자 제거
			var expText = /[%=><]/ ;
			if(expText.test(obj.value) == true){
				alert("특수문자를 입력 할수 없습니다.") ;
				obj.value = obj.value.split(expText).join("");
				return false;
			}

			//특정문자열(sql예약어의 앞뒤공백포함) 제거
			var sqlArray = new Array(
					//sql 예약어
					"OR", "SELECT", "INSERT", "DELETE", "UPDATE", "CREATE", "DROP", "EXEC",
					"UNION",  "FETCH", "DECLARE", "TRUNCATE"
			);

			var regex;
			for(var i=0; i<sqlArray.length; i++){
				regex = new RegExp( sqlArray[i] ,"gi") ;

				if (regex.test(obj.value) ) {
					alert("\"" + sqlArray[i]+"\"와(과) 같은 특정문자로 검색할 수 없습니다.");
					obj.value =obj.value.replace(regex, "");
					return false;
				}
			}
		}
		return true ;
	}

//값을 입력시킬때 enter키 안될시 사용된 함수로 다른기능으로 가는것은 막고, getAddr(); 만 실행되게 해둠
	function enterSearch() {
		// var evt_code = (window.netscape) ? ev.which : event.keyCode;
		if (event.keyCode === 13) {
			// event.keyCode = 0;
			event.preventDefault();
			getAddr(); //jsonp사용시 enter검색
		}
	}

	function addrPass() {
		var roadAddr = document.getElementById("roadAddr").getAttribute("value");
		var zipNo = document.getElementById("zipNo").getAttribute("value");
		opener.receiveAddressValues(roadAddr, zipNo);
		window.close();
	}

</script>

</body>
</html>
						